import { exit } from 'process';
import { getAttestationProof, isRoundFinalized, verifyProof } from '../../../lib/flare/attestation';

const roundId = 930866;
const abiEncodedRequest =
  '0x494a736f6e41706900000000000000000000000000000000000000000000000057454232000000000000000000000000000000000000000000000000000000000b62b2fe7066a5b56cd4cc859f4c802a02e2a0f84b5ad12893ef5a90651e588c0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000140000000000000000000000000000000000000000000000000000000000000001f68747470733a2f2f73776170692e6465762f6170692f70656f706c652f332f0000000000000000000000000000000000000000000000000000000000000000787b6e616d653a202e6e616d652c206865696768743a202e6865696768742c206d6173733a202e6d6173732c206e756d6265724f6646696c6d733a202e66696c6d73207c206c656e6774682c207569643a20282e75726c207c2073706c697428222f2229207c202e5b2d325d207c20746f6e756d626572297d000000000000000000000000000000000000000000000000000000000000000000000000000001737b22636f6d706f6e656e7473223a205b7b22696e7465726e616c54797065223a2022737472696e67222c20226e616d65223a20226e616d65222c202274797065223a2022737472696e67227d2c7b22696e7465726e616c54797065223a202275696e74323536222c20226e616d65223a2022686569676874222c202274797065223a202275696e74323536227d2c7b22696e7465726e616c54797065223a202275696e74323536222c20226e616d65223a20226d617373222c202274797065223a202275696e74323536227d2c7b22696e7465726e616c54797065223a202275696e74323536222c20226e616d65223a20226e756d6265724f6646696c6d73222c202274797065223a202275696e74323536227d2c7b22696e7465726e616c54797065223a202275696e74323536222c20226e616d65223a2022756964222c202274797065223a202275696e74323536227d5d2c226e616d65223a20227461736b222c2274797065223a20227475706c65227d00000000000000000000000000';

(async () => {
  const final = await isRoundFinalized(roundId);

  if (!final) {
    console.log('Round is not yet finalized.');
    return;
  }

  const proof = await getAttestationProof(roundId, abiEncodedRequest);
  console.log(proof);

  const verified = await verifyProof(proof);
  console.log(verified);
  exit(0);
})().catch(async (err) => {
  console.log(err);
  exit(1);
});
