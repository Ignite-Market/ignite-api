import { exit } from 'process';
import { getAttestationProof, isRoundFinalized, verifyProof } from '../../../lib/flare/attestation';

const roundId = 984680;
const abiEncodedRequest =
  '0x576562324a736f6e0000000000000000000000000000000000000000000000005075626c696357656232000000000000000000000000000000000000000000004ca9eb9892e659af212c492712f513784c79c120b6b18887f304749b0fe53b35000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000001e00000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000026000000000000000000000000000000000000000000000000000000000000002a0000000000000000000000000000000000000000000000000000000000000005268747470733a2f2f7675717a6d7061746f6a6c637176716363366e37763467726d7930706a7170692e6c616d6264612d75726c2e75732d656173742d312e6f6e2e6177732f3137343730353036343738393000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003474554000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000027b7d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000027b7d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000027b7d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000197b20226f7574636f6d65496478223a202e726573756c74207d00000000000000000000000000000000000000000000000000000000000000000000000000006d7b226e616d65223a227461736b222c2274797065223a227475706c65222c22636f6d706f6e656e7473223a5b7b226e616d65223a226f7574636f6d65496478222c2274797065223a2275696e74323536222c22696e7465726e616c54797065223a2275696e74323536227d5d7d00000000000000000000000000000000000000';

(async () => {
  const finalized = await isRoundFinalized(roundId);
  if (!finalized) {
    console.log('Round is not yet finalized.');
    return;
  }

  const proof = await getAttestationProof(roundId, abiEncodedRequest);
  console.log(proof);

  const verified = await verifyProof(proof);
  console.log(verified);
  exit(0);
})().catch(async (error) => {
  console.log(error);
  console.log(JSON.stringify(error, null, 2));
  exit(1);
});
