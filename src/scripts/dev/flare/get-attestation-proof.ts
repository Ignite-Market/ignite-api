import { exit } from 'process';
import { getAttestationProof, isRoundFinalized, verifyProof } from '../../../lib/flare/attestation';

const roundId = 1038280;
const abiEncodedRequest =
  '0x576562324a736f6e0000000000000000000000000000000000000000000000005075626c69635765623200000000000000000000000000000000000000000000a9bb03269629d9d25b2948ba9ec6b1584fcda3d48518227571c67a114e35caa0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000001c0000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000002400000000000000000000000000000000000000000000000000000000000000320000000000000000000000000000000000000000000000000000000000000004568747470733a2f2f6170692d70726f78792e69676e6974656d61726b65742e78797a2f7961686f6f2f6170692f76312f6d61726b6574732f73746f636b2f686973746f727900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000034745540000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000227b227469636b6572223a225e485349222c22696e74657276616c223a2233306d227d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b97b20226f7574636f6d65496478223a205b312c20305d5b28282e626f6479207c20746f5f656e74726965735b5d207c2073656c656374282e76616c75652e646174655f757463203d3d203137353138373532303029207c202e76616c75652e636c6f736529202f2f20282e626f6479207c20746f5f656e7472696573207c206c617374207c202e76616c75652e636c6f73652929203e3d203234303030207c206966202e207468656e203020656c7365203120656e645d207d00000000000000000000000000000000000000000000000000000000000000000000000000005f7b2274797065223a227475706c65222c22636f6d706f6e656e7473223a5b7b226e616d65223a226f7574636f6d65496478222c2274797065223a2275696e74323536222c22696e7465726e616c54797065223a2275696e74323536227d5d7d00';

(async () => {
  const finalized = await isRoundFinalized(roundId);
  if (!finalized) {
    console.log('Round is not yet finalized.');
    return;
  }

  const proof = await getAttestationProof(roundId, abiEncodedRequest);
  console.log(proof);

  const verified = await verifyProof(proof);
  console.log(verified);
  exit(0);
})().catch(async (error) => {
  console.log(error);
  console.log(JSON.stringify(error, null, 2));
  exit(1);
});
