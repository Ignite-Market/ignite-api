import { exit } from 'process';
import { getAttestationProof, isRoundFinalized, verifyProof } from '../../../lib/flare/attestation';

const roundId = 1001801;
const abiEncodedRequest =
  '0x576562324a736f6e0000000000000000000000000000000000000000000000005075626c69635765623200000000000000000000000000000000000000000000e3b9d9e0ff1f9c7bfcc1cf18e040dc5ca84b0707a58da4965e3e129b6147daa3000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000140000000000000000000000000000000000000000000000000000000000000018000000000000000000000000000000000000000000000000000000000000001c0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000002400000000000000000000000000000000000000000000000000000000000000280000000000000000000000000000000000000000000000000000000000000002868747470733a2f2f6d6f636b2d6170692e69676e6974656d61726b65742e78797a2f617069332f310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003474554000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000027b7d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000027b7d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000027b7d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000197b20226f7574636f6d65496478223a202e726573756c74207d00000000000000000000000000000000000000000000000000000000000000000000000000005f7b22636f6d706f6e656e7473223a5b7b22696e7465726e616c54797065223a2275696e74323536222c226e616d65223a226f7574636f6d65496478222c2274797065223a2275696e74323536227d5d2c2274797065223a227475706c65227d00';

(async () => {
  const finalized = await isRoundFinalized(roundId);
  if (!finalized) {
    console.log('Round is not yet finalized.');
    return;
  }

  const proof = await getAttestationProof(roundId, abiEncodedRequest);
  console.log(proof);

  const verified = await verifyProof(proof);
  console.log(verified);
  exit(0);
})().catch(async (error) => {
  console.log(error);
  console.log(JSON.stringify(error, null, 2));
  exit(1);
});
